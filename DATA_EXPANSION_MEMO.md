# 競艇スクレイピング - データ拡張候補メモ

## 現在抽出中のデータ
- 逃げ率（1年間・半年間）
- 逃がし率（1年間・半年間）
- 差され率（1年間）
- 捲られ率（1年間）
- 直近10レース1着回数

## 抽出可能な追加データ

> **注意**: 以下のデータは **1号艇特化データ** と **全艇共通統計データ** に分類されます。
> 
> - 🎯 **1号艇特化**: 特定の艇（現在は1号艇）のみのデータ
> - 📊 **全艇共通**: 全艇に共通する統計データ  
> - 🔄 **各艇個別**: 各艇ごとに個別に抽出可能なデータ

### 1. 選手基本情報 【優先度：高】🔄
- [ ] 選手名（フルネーム）
- [ ] 選手番号（4桁の登録番号）
- [ ] 級別（A1, A2, B1, B2）
- [ ] 期別（69期、115期など）
- [ ] 出身支部（埼玉、大阪、静岡、愛知、福岡、東京など）
- [ ] 性別（女性選手は特別マーク付き）

### 2. 詳細成績データ 【優先度：高】🔄

#### 1着率データ
- [ ] 今期
- [ ] 直近6ヶ月
- [ ] 直近3ヶ月
- [ ] 直近1ヶ月
- [ ] 当地（該当競艇場での成績）
- [ ] 一般戦
- [ ] SG/G1

#### 2連対率データ
- [ ] 今期
- [ ] 直近6ヶ月
- [ ] 直近3ヶ月
- [ ] 直近1ヶ月
- [ ] 当地
- [ ] 一般戦
- [ ] SG/G1

#### 3連対率データ
- [ ] 今期
- [ ] 直近6ヶ月
- [ ] 直近3ヶ月
- [ ] 直近1ヶ月
- [ ] 当地
- [ ] 一般戦
- [ ] SG/G1

#### 枠別勝率
- [ ] 直近1年
- [ ] 直近6ヶ月

### 3. スタートタイミング関連データ 【優先度：高】🔄

#### 平均ST（スタートタイミング）
- [ ] 今期
- [ ] 直近6ヶ月
- [ ] 直近3ヶ月
- [ ] 直近1ヶ月
- [ ] 当地
- [ ] 一般戦
- [ ] SG/G1
- [ ] 初日
- [ ] 最終日
- [ ] ナイター
- [ ] F持（フライング前歴持ち）

#### ST順位
- [ ] 上記と同じ条件別で利用可能

#### ST考察データ
- [ ] 安定率
- [ ] 抜出率
- [ ] 出遅率

### 4. 決まり手データ 【優先度：中】📊

#### 直近6ヶ月の決まり手率（共通統計）
- [ ] 逃げ
- [ ] 逃がし（逃がされ率）
- [ ] 差し（コース別）
- [ ] 差され
- [ ] 捲り（コース別）
- [ ] 捲られ

### 5. 個別レース履歴データ 【優先度：中】🎯

#### 過去10走データ（1号艇特化→各艇対応可能）
- [x] 直近10レース1着回数（現在実装済み）
- [ ] 各レースの着順詳細
- [ ] 各レースのコース
- [ ] 各レースの開催場
- [ ] 各レースの日付

### 6. レース基本情報 【優先度：中】📊

#### レース情報
- [ ] レース名（例：「上州きりゅう杯　やんちきどっこい賞競走」）
- [ ] 開催場（例：桐生）
- [ ] レース日（例：初日）
- [ ] レース番号（例：1R）
- [ ] 開催日（例：2025年07月04日）
- [ ] レースグレード（例：予選）

#### 隠されたメタデータ
- [ ] place_no（例：1（桐生））
- [ ] race_no（例：1）
- [ ] hiduke（例：20250704）
- [ ] race_rank（例：予選）
- [ ] race_date_name（例：初日）

### 7. 動的データ（AJAX取得が必要） 【優先度：低】

#### モーター関連データ 🔄
- [ ] モーター番号
- [ ] モーター成績（勝率、1着率、2着率、3着率）
- [ ] モーター決まり手率（逃げ、差し、捲り、捲差、抜き、恵まれ）
- [ ] 使用選手履歴

#### 展示・試走データ 🔄
- [ ] 展示タイム
- [ ] 周回タイム
- [ ] 回り足
- [ ] 直線タイム
- [ ] 展示順位

#### オッズ情報 📊（**⚠️ 現在のHTMLには含まれていません**）
- [ ] 三連単オッズ（別ページまたはAJAX取得が必要）
- [ ] 三連複オッズ（別ページまたはAJAX取得が必要）
- [ ] 二連単オッズ（別ページまたはAJAX取得が必要）
- [ ] 二連複オッズ（別ページまたはAJAX取得が必要）

#### 詳細分析データ 🔄
- [ ] 着順分析
- [ ] 着順分析グラフ
- [ ] ST分布値
- [ ] ST履歴

## 実装計画（データ分類別）

### フェーズ1：基本情報拡張
**🔄 各艇個別データ（1号艇→全艇対応）**
- 選手基本情報（名前、番号、級別、期別、支部）
- 詳細成績データ（1着率、2連対率、3連対率の各期間別）
- ST関連データ（平均ST、ST順位、安定率、出遅率）

### フェーズ2：統計データ追加
**📊 全艇共通統計データ**
- 決まり手データ（逃げ、差し、捲りの詳細分析）
- 枠別勝率
- レース基本情報

**🎯 1号艇特化データの拡張**
- 個別レース履歴の詳細化（着順、コース、開催場、日付）

### フェーズ3：高度なデータ取得
**AJAX取得データ（🔄各艇個別 + 📊共通統計）**
- モーター詳細データ（各艇個別）
- 展示タイムデータ（各艇個別）
- オッズ情報（共通統計）

### データ分類と実装方針

#### 🎯 1号艇特化データ → 🔄 各艇個別データ化
- **現状**: 1号艇の特定行からデータ抽出
- **拡張案**: 各艇の行を特定してデータ抽出
- **実装**: 行インデックスの計算式（Row = 2 + 艇番号 * 4）

#### 📊 全艇共通統計データ
- **現状**: 全艇に共通する統計を抽出
- **拡張案**: 追加の共通統計項目を取得
- **実装**: 既存のテーブル解析手法を応用

#### 🔄 各艇個別データ
- **新規**: テーブル構造から各艇の個別データを抽出
- **実装**: CSSセレクタでcourse1-6クラスを活用

## 技術的な実装メモ

### ⚠️ **重要：データ抽出の分類（1号艇特化 vs 共通統計）**

現在のプログラムには**2種類のデータ抽出**が混在しています：

#### 🎯 **1号艇特化データ**
- **直近10レース1着回数**: Tables[5] Row[5]から1号艇のみの着順データを抽出
- `row_values.iter().filter(|&v| v == "1").count()` で1号艇の1着回数をカウント

#### 📊 **全艇共通統計データ**  
- **逃げ率・逃がし率**: 全艇に共通する統計データを抽出
- **差され率・捲られ率**: 全艇に共通する統計データを抽出

### 現在の実装の詳細
- URLパラメータ`slider=1`は**Webページ指定**（特定艇データ表示用）
- HTMLテーブルは全艇分のデータを含む
- パーサーは**混合アプローチ**：
  - 共通統計: 全艇対象テーブルから抽出
  - 個別データ: 1号艇の特定行から抽出

### テーブル構造（Tables[5] = 過去10走テーブル）
```
Row 2:  1号艇のデータ行
Row 6:  2号艇のデータ行  
Row 10: 3号艇のデータ行
Row 14: 4号艇のデータ行
Row 18: 5号艇のデータ行
Row 22: 6号艇のデータ行
```

### 拡張時の設計判断
1. **1号艇特化継続** - 現在の仕様を維持
2. **全艇個別対応** - 各艇の個別データを配列で取得
3. **選択可能方式** - パラメータで対象艇を指定

### HTMLパース対象
- 静的HTMLから抽出可能なデータはscraperクレートで対応
- CSSセレクタまたはXPathでの要素特定が必要
- **1号艇のみ vs 全艇対応**の設計判断が必要

### AJAX取得対象
- headless_chromeでJavaScript実行が必要
- 動的コンテンツの読み込み待機処理が必要

### データ構造拡張
- 現在の`RaceData`構造体を拡張
- 新しい構造体の定義が必要（`PlayerData`, `MotorData`等）
- **1号艇のみ vs 全艇配列**の設計判断が必要

## 参考ファイル
- HTMLサンプル：`/home/shotaro/bort-scraping/src-tauri/bort-html/20250704/biyori.html`
- 現在のパーサー：`src-tauri/src/parse/biyori/flame.rs`
- メインライブラリ：`src-tauri/src/lib.rs`

---

作成日：2025-07-05  
更新日：2025-07-05